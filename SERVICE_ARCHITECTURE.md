# Catherine Service Architecture

## 現在の問題点
複数のサービス統合クラスが重複・競合しており、責任が不明確

### 重複しているサービス：
- **TODO管理**: FirebaseTodoManager, ExternalTodoManager, todo_manager
- **Google統合**: GoogleServicesIntegration, GoogleIntegration  
- **複雑な依存関係**: MCP + Firebase + 直接API

## 提案：クリーンな棲み分け

### レイヤー1：外部サービス統合（実際のAPI呼び出し）
```
NotionAPI           GoogleAPI           Firebase
    |                   |                   |
MCPブリッジ経由      直接OAuth           直接SDK
```

### レイヤー2：サービス別責任分担

#### 📋 **Notion** → **プロジェクト管理・ドキュメント**
- **役割**: 長期プロジェクト、詳細な説明が必要なタスク
- **用途**: 
  - 📝 プロジェクト計画書
  - 📊 進捗管理
  - 📚 ナレッジベース
  - 🔗 関連リンク・資料管理

#### 📱 **Google Tasks** → **日常タスク・リマインダー**  
- **役割**: 短期・日常的なタスク
- **用途**:
  - ✅ 買い物リスト
  - ⏰ 短期リマインダー
  - 📅 カレンダー連携
  - 🔄 定期タスク

#### 🔥 **Firebase** → **チャット・一時データ**
- **役割**: Discord内でのみ使用する一時的なデータ
- **用途**:
  - 💬 会話履歴
  - 📈 使用統計
  - ⚡ リアルタイム通知
  - 🔄 フォールバック

### レイヤー3：統合インターフェース（Catherine側）

```
CatherineBot
    |
UnifiedMessageHandler
    |
┌──────────────────┬──────────────────┬────────────────┐
│  NotionManager   │  GoogleManager   │  LocalManager  │
│  (長期プロジェクト)  │  (日常タスク)      │  (一時データ)    │  
└──────────────────┴──────────────────┴────────────────┘
```

## 実装優先度

### Phase 1: 重複統合の整理
1. **削除**: 重複するGoogle統合クラス
2. **統合**: TODO管理を1つのインターフェースに統一
3. **明確化**: 各サービスの責任範囲を定義

### Phase 2: スマートルーティング
```python
# ユーザーの意図に応じて自動振り分け
if "プロジェクト" or "詳細" or "長期":
    → Notion
elif "今日" or "明日" or "リマインド":  
    → Google Tasks
else:
    → 両方に作成（バックアップ）
```

### Phase 3: 統合ビュー
```
📋 統合TODO表示:
🔴 [Notion] 来月のプレゼン資料作成 (高優先度)
🟡 [Google] 牛乳を買う (今日)
🟢 [Local] チャット会話の要約 (自動生成)
```

## メリット

### ✅ 明確な責任分担
- 各サービスが得意分野を担当
- 開発者が迷わない
- ユーザーも理解しやすい

### ✅ 冗長性・安定性
- 一つのサービスが落ちても他でカバー
- データロストなし
- パフォーマンス向上

### ✅ 拡張性
- 新しいサービス追加が容易
- 既存機能を壊さない
- 段階的移行可能

## 次のアクション
1. 重複クラスの削除・統合
2. 明確なインターフェース定義
3. ユーザー向け使い方ガイド作成