# Catherine AI - 高性能 Discord AI アシスタント 🤖

## 🎯 概要

Catherineは荒れ地の魔女のような品のあるおばあさんの性格を持つ高性能AI秘書です。  
Discord上で**TODO管理、Google Workspace統合、自然言語処理、チャンネル制御**など多彩な機能を提供します。

## ✨ 主な機能

### 🏠 **スマートチャンネル制御**
- **#catherineチャンネル**: 全ての会話に自動応答（自然な対話）
- **その他許可チャンネル (#一般、#suzunebrain等)**: @catherine メンションで呼び出し可能
- **DM**: 常時応答でプライベート会話
- **非許可チャンネル**: 完全に無視（邪魔しません）
- **チャンネルID設定**: 環境変数で厳密なチャンネル制御が可能

### 🌐 **Google Workspace完全統合**
- **Gmail**: メール確認・件名取得・監視機能・OAuth認証対応
- **Google Tasks**: タスク作成・管理・完了処理・期限設定
- **Google Docs**: ドキュメント作成・編集・レポート生成・共有設定
- **Google Sheets**: スプレッドシート作成・データ管理・計算式対応
- **Google Drive**: ファイル整理・フォルダ管理・共有機能
- **Google Calendar**: 予定作成・イベント管理・リマインダー・定期予定

### 🧠 **高度自然言語処理**
- **多様な表現理解**: 「メール確認して」「タスク作って」「資料作成」など自然な会話
- **確認システム**: 曖昧な指示には選択肢を提示して確認
- **人間らしい応答**: バリエーション豊かな返答パターンと感情表現
- **日本語完全対応**: 丁寧語から関西弁まで理解・適応
- **意図推定システム**: 複数のキーワードから最適なアクションを判定

### 📝 **TODO管理システム**
- **自然言語でTODO操作**: 「アクリルキーホルダー入稿を追加」のような自然な文章でTODO追加
- **優先度システム**: ⚫激高、🔴高、🟡普通、🟢低の4段階優先度
- **自動ソート**: 優先度順に自動並び替え（激高 → 高 → 普通 → 低）
- **複数削除**: 「1.2.3.5は削除して」で複数のTODOを一度に削除
- **優先度変更**: 「5は優先度激高に変えて」で簡単に優先度変更
- **名前変更**: 「1は買い物リストにして」でTODO名前変更

### ⏰ **リマインダーシステム**
- **個別リマインダー**: 「1を1分後にリマインドして」で個別TODO通知
- **毎日リマインダー**: 「毎日毎朝8:30に全リストをリマインドして」で定期通知
- **チャンネル指定**: #todoチャンネルなど、指定したチャンネルに通知
- **メンション機能**: @everyoneや特定ユーザーへのメンション通知

### 🎭 **荒れ地の魔女パーソナリティ**
- **魔女風の口調**: 「ふふ、また仕事を増やすのかい？」のような品のある魔女らしい話し方
- **ランダムな一言**: TODOリスト表示時に毎回違った魔女らしいコメント
- **時間帯挨拶**: 朝、昼、夜に応じた魔女らしい挨拶
- **優先度コメント**: 優先度に応じた魔女らしいアドバイス

## 🗣️ 使い方

### 🏠 **チャンネル別の使い方**

#### **#catherine チャンネル**
```
おはよう Catherine！
今日のタスクを作成して
メールを3通確認して
明日の会議資料をドキュメントで作って
売上データのスプレッドシート作成
```
*メンション不要。すべての発言に応答します。*

#### **その他のチャンネル (#一般、#suzunebrain など)**
```
@catherine タスク作成して
Catherine、メール確認お願いします
@catherine 来週の予定を教えて
```
*@catherine でメンションが必要です。*

#### **DM（プライベート会話）**
```
個人的なタスクを管理したい
プライベートな予定を相談
秘密の プロジェクト用ドキュメント作成
```
*常に応答。プライベートな内容に最適。*

### 🌐 **Google Workspace操作**

#### **Gmail操作**
```
メール確認して
最新5件のメールを見せて
新着メールはある？
今日のメール件数を教えて
重要なメールがあるか確認
```

#### **Google Tasks操作**  
```
「会議準備」のタスク作成
タスクリストを見せて
タスクを完了にして
明日までに「資料作成」のタスク追加
期限付きタスクを作成して
```

#### **Google Docs操作**
```
「プロジェクト報告書」のドキュメント作って
会議資料をまとめて
「Catherine統合レポート」の文書作成
共有可能なドキュメント生成
```

#### **Google Sheets操作**
```
「売上管理表」のスプレッドシート作成
データ分析用の表を作って
「タスク管理シート」を作成
計算式付きのスプレッドシート作成
```

#### **Google Drive操作**
```
「Catherine プロジェクト」フォルダ作成
ファイルを整理して
共有フォルダを作成
プロジェクト用のフォルダ構成を作って
```

#### **Google Calendar操作**
```
明日14時に会議予定を追加
来週の予定を確認して
「定例ミーティング」を月曜10時に設定
定期的な予定を作成
今日の予定を教えて
```

### **基本的なTODO操作**

#### TODO追加
```
アクリルキーホルダー入稿を追加
「買い物リスト」を作成
明日までに資料作成（激高優先度）
```

#### TODOリスト表示
```
リスト
一覧見せて
TODOだして
```

#### TODO削除
```
1番削除
2.3.5は消して
1と4を削除して
```

#### 優先度変更
```
5は優先度激高に変えて
3を高優先度にして
1は普通にして
```

#### TODO名前変更
```
1は買い物リストにして
2の名前を会議準備に変更
```

### **リマインダー設定**

#### 個別リマインダー
```
1を1分後にリマインドして
3を明日リマインド
5を今すぐリマインド
```

#### 毎日リマインダー
```
毎日毎朝8:30に全リストをリマインドして
毎晩22:00にリストを通知して
```

### **Catherineとの会話**
TODOコマンド以外にも、Catherineと自然に会話できます。OpenAI GPT-4oを使った高品質な対話が可能です。

## 🎯 優先度システム

### 優先度レベル
- **⚫ 激高**: 最高優先度、緊急、クリティカル、即座対応
- **🔴 高**: 重要、大事、優先、急ぎ
- **🟡 普通**: 通常、標準、デフォルト（設定なしの場合）
- **🟢 低**: 後回し、あとで、いつでも、余裕がある時

### 自動ソート機能
- TODOリストは常に優先度順で表示
- 優先度変更時に自動的にリストが並び替え
- 同じ優先度内では作成日順でソート

## ⚙️ セットアップ

### 1. 環境変数設定
```env
# Discord設定
DISCORD_BOT_TOKEN=your-bot-token
DISCORD_CLIENT_ID=your-client-id
ALLOWED_SERVER_IDS=your-server-ids

# チャンネル制御設定
ALLOWED_CHANNEL_IDS=1401831166117544043,1404390881326268476,1404452180416532550
CATHERINE_CHANNEL_IDS=1401958031788478526

# OpenAI設定
OPENAI_API_KEY=sk-your-openai-key

# Google OAuth設定（Google Workspace統合用）
GOOGLE_OAUTH_CLIENT_ID=your-google-client-id
GOOGLE_OAUTH_CLIENT_SECRET=your-google-client-secret
GMAIL_REFRESH_TOKEN=your-gmail-refresh-token
GOOGLE_FULL_REFRESH_TOKEN=your-full-google-refresh-token

# Firebase設定（TODO管理用）
# firebase-key.json ファイルをプロジェクトルートに配置
```

### 2. Discordボット権限
- メッセージを送信
- メッセージ履歴を読む
- スラッシュコマンドを使用
- メンション@everyoneを使用

### 3. Google OAuth設定
- Google Cloud Consoleで OAuth 2.0 クライアントIDを作成
- リダイレクトURIに `http://localhost:3000/auth/google/callback` を追加
- `get-full-google-token.js` を実行してリフレッシュトークンを取得

### 4. Firebase設定
- Firestoreデータベースを有効化
- サービスアカウントキーを`firebase-key.json`として保存

## 🚀 デプロイ

### Railway（推奨）
```bash
# リポジトリをRailwayに接続
# 環境変数を設定
# 自動デプロイ
```

### ローカル実行
```bash
pip install -r requirements.txt
python -m src.main
```

## 🤖 Catherineの性格

### 基本的な話し方
- 「ふふ、○○だね」「やれやれ、○○だよ」
- 「あらあら」「おやおや」「まったく」
- 品があって少し意地悪だけど優しいおばあさん

### TODOに対するコメント例
- 「ふむ、『アクリルキーホルダー入稿』ね。覚えておいてあげるよ」
- 「また仕事を増やすのかい？まったく、忙しい人だねぇ」
- 「優先度を変えるのかい？まあ、大事なことは先にやるもんだよ」

### ランダムな一言集
- 「さあ、今日も頑張るんだよ」
- 「一つずつ片付けていきな」
- 「やることが山積みだねぇ」
- 「まったく、忙しい人だこと」

## 📊 データ管理

### Firebase構造
```
todos/
  ├── user_id: "Discord ユーザーID"
  ├── title: "TODOタイトル"
  ├── priority: "urgent|high|normal|low"
  ├── status: "pending|completed"
  ├── created_at: "作成日時（JST）"
  └── due_date: "期限日時（設定時）"

conversations/
  ├── user_id: "ユーザーID"
  ├── user_message: "ユーザーメッセージ"
  ├── bot_response: "Catherineの返答"
  └── timestamp: "日時（JST）"
```

## 🔧 カスタマイズ

### 魔女パーソナリティの調整
`src/personality_system.py`で話し方や性格をカスタマイズ可能：
- 基本的な口調パターン
- 状況別の返答バリエーション
- 時間帯別の挨拶

### NLU（自然言語理解）の調整
`src/todo_nlu.py`でコマンド認識をカスタマイズ：
- 優先度キーワードの追加
- 新しいアクションパターンの追加
- 時間表現の拡張

## 🚨 トラブルシューティング

### よくある問題

**Catherineが反応しない**
- Discord Bot Tokenが正しいか確認
- サーバーIDがALLOWED_SERVER_IDSに含まれているか確認

**TODOが保存されない**
- firebase-key.jsonファイルが存在するか確認
- Firestoreが有効化されているか確認

**リマインダーが動作しない**
- スケジューラーシステムが起動しているか確認
- 時間指定が正しく認識されているか確認

## 💡 使用のコツ

1. **自然な文章でOK**: 「○○を追加して」「○○は削除」など自然に話しかける
2. **優先度は後からでも変更可能**: まずはTODOを追加してから優先度調整
3. **番号で操作**: 表示された番号で削除や変更が簡単
4. **毎日リマインダーが便利**: 朝の習慣として全TODOを確認
5. **Catherineとの雑談も楽しめる**: TODO以外の話題でも会話可能

---

**荒れ地の魔女Catherineと一緒に、効率的なTODO管理を始めましょう！ 🧙‍♀️✨**