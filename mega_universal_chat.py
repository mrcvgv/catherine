#!/usr/bin/env python3
"""
Mega Universal Chat - Catherine AI 超汎用会話システム
日常生活のあらゆる会話に対応する異次元レベルの汎用性
"""

import random
import re
from typing import Dict, List, Optional

class MegaUniversalChat:
    def __init__(self):
        self.universal_patterns = self._init_universal_patterns()
        self.contextual_responses = self._init_contextual_responses()
        self.emotional_responses = self._init_emotional_responses()
        self.situational_responses = self._init_situational_responses()
        
    def _init_universal_patterns(self) -> Dict[str, List[str]]:
        """超汎用パターン - あらゆる日常会話をカバー"""
        return {
            # 基本挨拶 - どんな形でも
            'よう': ['よー', 'よう！', 'おっす', 'やあ', 'どうも'],
            'おっす': ['おっす！', 'よー', 'やあ', 'どうも', 'よう'],
            'やあ': ['やあー！', 'よー', 'おっす', 'どうも', 'よう'],
            'おい': ['よー', 'おっす', 'どうした？', 'なに？'],
            'おーい': ['よー', 'なに？', 'どうした？', 'はーい'],
            'おはよう': ['おはよー！', 'おはよう', 'モーニング', 'おは'],
            'おは': ['おはよー', 'おはよう', 'モーニング', 'おっす'],
            'こんにちは': ['こんにちは！', 'お疲れさま', 'よー', 'どうも'],
            'こんばんは': ['こんばんは！', 'お疲れさま', 'よー', 'どうも'],
            'お疲れ': ['お疲れさま', 'お疲れー', 'よー', 'どうも'],
            'おつかれ': ['お疲れさま', 'お疲れー', 'よー'],
            
            # 元気・調子系 - あらゆる聞き方に対応
            '元気': ['元気だよー', 'まあまあ', 'ぼちぼち', 'そっちは？', 'いい感じ'],
            'げんき': ['元気だよー', 'まあまあ', 'ぼちぼち', 'そっちは？'],
            '元気？': ['元気だよー', 'まあまあ', 'そっちは？', 'ぼちぼち'],
            'げんき？': ['元気だよー', 'まあまあ', 'そっちは？', 'ぼちぼち'],
            'げんきか': ['元気だよー', 'まあまあ', 'そっちはどう？', 'ぼちぼち'],
            'げんきか？': ['元気だよー', 'まあまあ', 'そっちはどう？', 'ぼちぼち'],
            '元気か': ['元気だよー', 'まあまあ', 'そっちはどう？', 'ぼちぼち'],
            '元気か？': ['元気だよー', 'まあまあ', 'そっちはどう？', 'ぼちぼち'],
            '調子どう': ['まあまあ', 'いい感じ', 'ぼちぼち', 'そっちは？'],
            '調子どう？': ['まあまあ', 'いい感じ', 'ぼちぼち', 'そっちは？'],
            'ちょうしどう': ['まあまあ', 'いい感じ', 'ぼちぼち', 'そっちは？'],
            'ちょうしどう？': ['まあまあ', 'いい感じ', 'ぼちぼち', 'そっちは？'],
            'どう': ['まあまあかな', 'いい感じ', 'ぼちぼち', 'そっちは？'],
            'どう？': ['まあまあかな', 'いい感じ', 'ぼちぼち', 'そっちは？'],
            'どうよ': ['まあまあかな', 'いい感じ', 'ぼちぼち', 'そっちは？'],
            'どうよ？': ['まあまあかな', 'いい感じ', 'ぼちぼち', 'そっちは？'],
            'どうだ': ['まあまあかな', 'いい感じ', 'ぼちぼち', 'そうだね'],
            'どうだ？': ['まあまあかな', 'いい感じ', 'ぼちぼち', 'そうだね'],
            '最近どう': ['まあまあ', 'ぼちぼちやってる', 'そこそこ', 'そっちは？'],
            '最近どう？': ['まあまあ', 'ぼちぼちやってる', 'そこそこ', 'そっちは？'],
            'さいきん': ['最近どう？', 'まあまあ', 'ぼちぼち', 'そっちは？'],
            'さいきんどう': ['まあまあ', 'ぼちぼちやってる', 'そっちは？'],
            'さいきんどう？': ['まあまあ', 'ぼちぼちやってる', 'そっちは？'],
            
            # 相槌・同意 - あらゆるパターン
            'うん': ['そうそう', 'うん', 'そうだね', 'わかる', 'だよね'],
            'そう': ['そうそう', 'だよね', 'うん', 'そうなの', 'わかる'],
            'そうそう': ['だよね', 'うん', 'そう', 'わかる', 'ほんと'],
            'そうね': ['そうね', 'そうだね', 'うん', 'そうそう', 'だよね'],
            'そうか': ['そうそう', 'そうなんだ', 'うん', 'なるほど'],
            'そうなんだ': ['うん', 'そうそう', 'へー', 'なるほど', 'そっか'],
            'だよね': ['そうそう', 'うん', 'ほんとに', 'わかる', 'だよな'],
            'だよな': ['だよね', 'そうそう', 'うん', 'ほんと', 'わかる'],
            'そうだね': ['うん', 'そうそう', 'だよね', 'ほんと', 'わかる'],
            'そうよね': ['だよね', 'そうそう', 'そうね', 'ほんと'],
            'なるほど': ['そうそう', 'だよね', 'うん', 'そうなんだ', 'へー'],
            'へー': ['そうなんだ', 'なるほど', 'おもしろい', 'そっか', 'へー'],
            'ふーん': ['そうなんだ', 'なるほど', 'へー', 'そっか'],
            'そっか': ['そうそう', 'うん', 'そうなんだ', 'だよね', 'なるほど'],
            'わかる': ['だよね', 'そうそう', 'ほんと', 'うん', 'すごくわかる'],
            'たしかに': ['でしょ', 'だよね', 'そうそう', 'ほんとに', 'わかる'],
            'でしょ': ['だよね', 'そうそう', 'たしかに', 'わかる', 'ほんと'],
            'まさに': ['そうそう', 'だよね', 'ほんとに', 'たしかに', 'わかる'],
            'ほんとに': ['まさに', 'そうそう', 'だよね', 'たしかに', 'ほんと'],
            'ほんと': ['ほんとに', 'そうそう', 'だよね', 'まさに', 'わかる'],
            
            # 返事・応答パターン
            'いいよ': ['よかった', 'そっか', 'いいね', 'そうなんだ', 'うん'],
            'いい': ['よかった', 'そっか', 'いいね', 'そうなんだ', 'うん'],
            'よい': ['よかった', 'そっか', 'いいね', 'そうなんだ'],
            'よかった': ['よかったね', 'いいね', 'そっか', 'うん', 'ほんと'],
            'だいじょうぶ': ['よかった', 'そっか', 'いいね', '安心した', 'うん'],
            '大丈夫': ['よかった', 'そっか', 'いいね', '安心した', 'うん'],
            'まあまあ': ['まあまあか', 'そっか', 'ぼちぼちだね', 'うん'],
            'ぼちぼち': ['ぼちぼちね', 'そっか', 'まあまあか', 'うん'],
            'そこそこ': ['そこそこか', 'そっか', 'まあまあね', 'うん'],
            '普通': ['普通か', 'そっか', 'まあまあね', 'うん', 'ふつうだね'],
            'ふつう': ['普通か', 'そっか', 'まあまあね', 'うん'],
            
            # 感嘆・驚き
            'すごい': ['だよね！', 'ほんとに', 'やばい', 'すごくない？', 'でしょ'],
            'すごいね': ['だよね', 'ほんとに', 'やばい', 'びっくり', 'でしょ'],
            'やばい': ['やばいよね', 'ほんと', 'マジで', 'だよね', 'すごい'],
            'やばいね': ['やばいよね', 'だよね', 'マジで', 'ほんと', 'すごい'],
            'マジで': ['マジマジ', 'ほんとに', 'やばい', 'すごくない？', 'だよね'],
            'まじで': ['マジマジ', 'ほんとに', 'やばい', 'だよね'],
            'マジ': ['マジで', 'ほんと', 'やばい', 'すごい', 'うそでしょ'],
            'まじ': ['マジで', 'ほんと', 'やばい', 'うそでしょ'],
            'いいね': ['いいよね', 'だよね', 'うん', 'すごくない？', 'でしょ'],
            'えー': ['えー！', 'まじで？', 'うそ', 'びっくり', 'ほんと？'],
            'うそ': ['うそでしょ', 'まじで？', 'えー', 'びっくり', 'ほんと？'],
            'うそでしょ': ['まじで？', 'えー', 'びっくり', 'やばい', 'ほんと？'],
            'びっくり': ['びっくりだね', 'すごい', 'まじで？', 'やばい'],
            'おどろいた': ['びっくりだね', 'すごい', 'まじで？', 'やばい'],
            'すげー': ['すげーね', 'やばい', 'すごい', 'マジで'],
            'すっげー': ['すっげーね', 'やばい', 'すごい', 'マジで'],
            
            # 疲れ・体調関連
            '疲れた': ['お疲れさま', 'ゆっくりして', '大丈夫？', 'しんどそう', '無理しないで'],
            'つかれた': ['お疲れさま', 'ゆっくりして', '大丈夫？', 'しんどそう'],
            '疲れてる': ['お疲れさま', 'ゆっくりして', '大丈夫？', '無理しないで'],
            'つかれてる': ['お疲れさま', 'ゆっくりして', '大丈夫？'],
            'しんどい': ['大丈夫？', 'お疲れさま', 'ゆっくりして', '無理しないで'],
            'だるい': ['だるいね', 'お疲れさま', '大丈夫？', 'ゆっくりして'],
            'だるいわ': ['だるいね', 'お疲れさま', '大丈夫？'],
            '眠い': ['眠いね', '寝たら？', 'お疲れさま', 'ゆっくりして'],
            'ねむい': ['眠いね', '寝たら？', 'お疲れさま'],
            '眠たい': ['眠たいね', '寝たら？', 'お疲れさま'],
            'ねむたい': ['眠たいね', '寝たら？', 'お疲れさま'],
            'ねみー': ['眠いね', '寝たら？', 'お疲れさま'],
            '寝不足': ['寝不足だね', 'お疲れさま', '早く寝なよ', '大丈夫？'],
            '忙しい': ['忙しそうだね', 'お疲れさま', '頑張って', '大変だね', '無理しないで'],
            'いそがしい': ['忙しそうだね', 'お疲れさま', '頑張って', '大変だね'],
            '忙しすぎ': ['忙しすぎだね', 'お疲れさま', '大変だね', '体に気をつけて'],
            
            # 暇・リラックス
            '暇': ['暇だね', '何しよう', 'のんびりしよ', 'ゆっくりしよ', '何かある？'],
            'ひま': ['暇だね', '何しよう', 'のんびりしよ', 'ゆっくりしよ'],
            '暇だ': ['暇だね', '何しよう', 'のんびりしよ', 'いいじゃん'],
            'ひまだ': ['暇だね', '何しよう', 'のんびりしよ'],
            'することない': ['何しよう', '暇だね', 'のんびりしよ', 'ゆっくりしな'],
            'やることない': ['何しよう', '暇だね', 'のんびりしよ'],
            '時間ある': ['時間あるんだ', 'いいね', 'のんびりできる', '何しよう'],
            'じかんある': ['時間あるんだ', 'いいね', 'のんびりできる'],
            
            # 食べ物関連
            'お腹すいた': ['わかる', '何食べる？', 'ご飯にしよ', '私も', 'お腹すくよね'],
            'おなかすいた': ['わかる', '何食べる？', 'ご飯にしよ', '私も'],
            '腹減った': ['わかる', '何食べる？', 'ご飯にしよ', '私も', '腹減るよね'],
            'はらへった': ['わかる', '何食べる？', 'ご飯にしよ'],
            '美味しい': ['よかったね', 'いいなあ', '美味しそう', '私も食べたい', 'いいね'],
            'おいしい': ['よかったね', 'いいなあ', '美味しそう', '私も食べたい'],
            'うまい': ['よかったね', 'いいなあ', 'うまそう', '私も食べたい', 'いいね'],
            'まずい': ['残念', 'そっか', 'うーん', 'だめだったか', 'そうなんだ'],
            'ご飯': ['ご飯か', '何食べる？', '美味しそう', 'いいね', 'お腹すく'],
            'ごはん': ['ご飯か', '何食べる？', '美味しそう', 'いいね'],
            '料理': ['料理すごい', '何作る？', '美味しそう', 'いいね', '上手だね'],
            'りょうり': ['料理すごい', '何作る？', '美味しそう'],
            
            # 天気関連
            '暑い': ['暑いよね', 'ほんと暑い', 'やばいよね', '溶けそう', 'エアコン欲しい'],
            'あつい': ['暑いよね', 'ほんと暑い', 'やばいよね'],
            '暑いね': ['ほんと暑い', 'やばいよね', '溶けそう', 'エアコン欲しい'],
            '寒い': ['寒いよね', 'ほんと寒い', 'やばいよね', '凍える', '暖房欲しい'],
            'さむい': ['寒いよね', 'ほんと寒い', 'やばいよね'],
            '寒いね': ['ほんと寒い', 'やばいよね', '凍える', '暖房欲しい'],
            '雨': ['雨だね', 'やだよね', '憂鬱', '嫌だなあ', '洗濯物'],
            'あめ': ['雨だね', 'やだよね', '憂鬱'],
            '雨だね': ['やだよね', '憂鬱', '洗濯物干せない', '傘いる'],
            'いい天気': ['いい天気だね', '気持ちいい', 'お出かけしたい', 'いいね'],
            'いいてんき': ['いい天気だね', '気持ちいい', 'お出かけしたい'],
            '晴れ': ['晴れだね', 'いい天気', '気持ちいい', 'お出かけしたい'],
            'はれ': ['晴れだね', 'いい天気', '気持ちいい'],
            
            # 時間関連
            '朝': ['朝だね', 'おはよう', '早いね', '眠い', 'モーニング'],
            'あさ': ['朝だね', 'おはよう', '早いね', '眠い'],
            '昼': ['昼だね', 'お疲れさま', 'ランチタイム？', 'お腹すく'],
            'ひる': ['昼だね', 'お疲れさま', 'ランチタイム？'],
            '夜': ['夜だね', 'こんばんは', '遅いね', 'お疲れさま'],
            'よる': ['夜だね', 'こんばんは', '遅いね'],
            '今日': ['今日どうだった？', '今日は何した？', 'お疲れさま', '一日早い'],
            'きょう': ['今日どうだった？', '今日は何した？', 'お疲れさま'],
            '明日': ['明日何する？', '明日頑張って', '明日楽しみ？', '一日早い'],
            'あした': ['明日何する？', '明日頑張って', '明日楽しみ？'],
            
            # 感情・気持ち
            '嬉しい': ['よかったね！', '私も嬉しい', 'やったね', 'よかった', '最高じゃん'],
            'うれしい': ['よかったね！', '私も嬉しい', 'やったね', 'よかった'],
            '楽しい': ['楽しそう！', 'いいなあ', 'よかったね', '私も楽しい', '最高'],
            'たのしい': ['楽しそう！', 'いいなあ', 'よかったね', '私も楽しい'],
            '幸せ': ['幸せそう', 'よかったね', 'いいなあ', '最高だね', '私も嬉しい'],
            'しあわせ': ['幸せそう', 'よかったね', 'いいなあ', '最高だね'],
            '悲しい': ['大丈夫？', 'つらいね', '元気出して', '心配', 'どうした？'],
            'かなしい': ['大丈夫？', 'つらいね', '元気出して', '心配'],
            'つらい': ['つらいね', '大丈夫？', '無理しないで', '心配だよ', '元気出して'],
            'ムカつく': ['わかる', 'それはムカつく', 'イライラするよね', '大変だね'],
            'むかつく': ['わかる', 'それはムカつく', 'イライラするよね'],
            'イライラ': ['わかる', 'イライラするよね', 'ストレス溜まる', '大丈夫？'],
            'いらいら': ['わかる', 'イライラするよね', 'ストレス溜まる'],
            
            # 質問・困った
            'どうしよう': ['大丈夫だよ', '何かあった？', '心配だね', '一緒に考えよう'],
            '困った': ['大変だね', '何かあった？', '大丈夫？', '手伝えること'],
            'こまった': ['大変だね', '何かあった？', '大丈夫？'],
            '分からない': ['難しいね', '大丈夫だよ', '一緒に考えよう', 'わからないよね'],
            'わからない': ['難しいね', '大丈夫だよ', '一緒に考えよう'],
            'わかんない': ['難しいね', '大丈夫だよ', '一緒に考えよう'],
            
            # ありがとう・謝罪
            'ありがとう': ['どういたしまして', 'いえいえ', '全然', 'こちらこそ'],
            'ありがと': ['どういたしまして', 'いえいえ', '全然'],
            'サンキュー': ['どういたしまして', 'いえいえ', '全然', 'You\'re welcome'],
            'thanks': ['You\'re welcome', 'どういたしまして', 'No problem'],
            'ごめん': ['大丈夫だよ', '気にしないで', '全然', 'いいよ'],
            'すまん': ['大丈夫', '気にしないで', '全然', 'いいよ'],
            'すみません': ['大丈夫ですよ', '気にしないで', '全然', 'いいですよ'],
            'sorry': ['No problem', '大丈夫だよ', 'It\'s okay'],
        }
        
    def _init_contextual_responses(self) -> Dict[str, List[str]]:
        """文脈的応答パターン"""
        return {
            # 仕事・学校
            '仕事': ['仕事お疲れさま', 'がんばって', '大変？', 'どんな感じ？'],
            '会社': ['会社お疲れさま', 'がんばって', '大変そう', 'どんな感じ？'],
            '学校': ['学校お疲れさま', 'がんばって', '勉強大変？', 'どんな感じ？'],
            '勉強': ['勉強がんばって', 'えらい', '大変だね', 'どんなの？'],
            'テスト': ['テストがんばって', '大変だね', 'どんな感じ？', '勉強してる？'],
            '宿題': ['宿題がんばって', '大変だね', 'どんなやつ？', 'がんばれ'],
            
            # 趣味・娯楽
            '映画': ['映画いいね', '何見る？', '面白そう', 'どんなの？'],
            '音楽': ['音楽いいね', '何聞く？', 'いい曲', 'どんなジャンル？'],
            'ゲーム': ['ゲームか', '面白い？', 'どんなゲーム？', 'やってみたい'],
            '本': ['本いいね', '何読む？', '面白そう', 'どんな本？'],
            'アニメ': ['アニメか', '何見る？', '面白そう', 'どんなの？'],
            'マンガ': ['マンガか', '何読む？', '面白そう', 'どんなの？'],
            'YouTube': ['YouTubeか', '何見る？', '面白そう', 'どんな動画？'],
            
            # 買い物・お金
            '買い物': ['買い物か', '何買う？', 'いいね', 'どこ行く？'],
            '買った': ['何買ったの？', 'いいね', 'よかったね', 'どんなの？'],
            '高い': ['高いよね', '大変だね', 'お金かかる', 'そうだよね'],
            '安い': ['安いね', 'いいじゃん', 'お得', 'よかったね'],
            'お金': ['お金大変', 'わかる', '節約しなきゃ', 'そうだよね'],
            
            # 健康・運動
            '運動': ['運動えらい', 'がんばって', 'いいね', 'どんなの？'],
            '散歩': ['散歩いいね', '気持ちよさそう', 'いい運動', 'どこ歩く？'],
            '病院': ['大丈夫？', 'お疲れさま', '心配', 'どうだった？'],
            '薬': ['大丈夫？', 'お疲れさま', '体調悪い？', '心配'],
        }
        
    def _init_emotional_responses(self) -> Dict[str, List[str]]:
        """感情的応答パターン"""
        return {
            # 興奮・テンション高い
            'やったー': ['やったね！', 'おめでとう！', '最高！', 'すごいじゃん'],
            'わーい': ['わーい', 'やったー', '嬉しい', '最高'],
            'イェーイ': ['イェーイ', 'やったー', '最高', 'すごい'],
            'やっほー': ['やっほー', 'テンション高い', '楽しそう', 'いいね'],
            
            # 落ち込み・ため息
            'はあ': ['どうした？', '大丈夫？', 'お疲れさま', 'ため息？'],
            'あー': ['どうした？', '疲れた？', '大丈夫？', 'お疲れさま'],
            'うーん': ['どうした？', '悩んでる？', '難しい？', 'そうだね'],
            'がーん': ['どうした？', 'ショック？', '大丈夫？', '残念'],
            
            # 考え中・迷い
            'んー': ['考えてる？', '悩んでる？', 'どうした？', '難しい？'],
            'えーっと': ['考えてる？', '悩んでる？', 'どうしよう？', '難しい？'],
            'あのー': ['なに？', '何かある？', 'どうした？', '言って'],
        }
        
    def _init_situational_responses(self) -> Dict[str, List[str]]:
        """状況別応答パターン"""
        return {
            # 出かける・移動
            '出かける': ['いってらっしゃい', '気をつけて', 'どこ行く？', '楽しんで'],
            '帰る': ['お疲れさま', 'おかえり', 'ゆっくりして', 'どうだった？'],
            '電車': ['電車か', '混んでる？', '気をつけて', '大変だね'],
            '車': ['車か', '気をつけて', '運転大変？', 'どこ行く？'],
            
            # 休む・寝る
            '寝る': ['おやすみ', 'ゆっくり休んで', '疲れた？', 'お疲れさま'],
            '休む': ['ゆっくり休んで', 'お疲れさま', '疲れた？', '無理しないで'],
            'お風呂': ['お風呂気持ちいい', 'ゆっくりして', '疲れ取れる', 'いいね'],
            
            # 家族・友人
            '家族': ['家族いいね', 'どんな感じ？', '大切だね', '仲良し？'],
            '友達': ['友達いいね', '楽しそう', 'いい友達', '何してる？'],
            '恋人': ['恋人いいね', '仲良し？', '楽しそう', '羨ましい'],
            
            # イベント・特別な日
            '誕生日': ['誕生日おめでとう！', 'おめでとう', '何歳？', 'お祝い'],
            'クリスマス': ['クリスマスだね', '楽しみ？', '何する？', 'いいね'],
            '正月': ['あけおめ', '今年もよろしく', 'お正月', 'どう過ごす？'],
        }
    
    def get_universal_response(self, user_input: str) -> Optional[str]:
        """超汎用応答生成"""
        clean_input = user_input.strip().lower()
        
        # 句読点・記号を除去
        for punct in ['!', '！', '?', '？', '~', '～', '.', '。', ':', '：', ',', '、']:
            clean_input = clean_input.replace(punct, '')
        
        # スペースを除去
        clean_input = clean_input.replace(' ', '')
        
        # 1. 直接マッチング（最優先）
        if clean_input in self.universal_patterns:
            return random.choice(self.universal_patterns[clean_input])
        
        # 2. 感情応答パターン
        for pattern, responses in self.emotional_responses.items():
            if pattern in clean_input:
                return random.choice(responses)
        
        # 3. 文脈応答パターン
        for pattern, responses in self.contextual_responses.items():
            if pattern in clean_input:
                return random.choice(responses)
        
        # 4. 状況応答パターン
        for pattern, responses in self.situational_responses.items():
            if pattern in clean_input:
                return random.choice(responses)
        
        # 5. 部分マッチング（汎用パターン）
        for pattern, responses in self.universal_patterns.items():
            if pattern in clean_input or clean_input in pattern:
                return random.choice(responses)
        
        # 6. キーワードベース推論
        return self._keyword_based_response(clean_input)
    
    def _keyword_based_response(self, text: str) -> Optional[str]:
        """キーワードベース応答"""
        # ポジティブキーワード
        positive_words = ['いい', 'よい', '良い', '楽しい', '嬉しい', '好き', '最高', '素晴らしい']
        if any(word in text for word in positive_words):
            return random.choice(['いいね', 'よかった', 'そうなんだ', '素敵', 'うん'])
        
        # ネガティブキーワード
        negative_words = ['悪い', 'だめ', 'つらい', '嫌', 'やだ', '最悪', 'しんどい']
        if any(word in text for word in negative_words):
            return random.choice(['大丈夫？', 'そっか', 'つらいね', '心配', 'どうした？'])
        
        # 質問っぽい
        if '？' in text or '?' in text or text.endswith(('か', 'の', 'かな', 'だっけ')):
            return random.choice(['そうだね', 'どうだろ', 'うーん', 'わからない', 'そうかも'])
        
        # デフォルト
        return random.choice(['そうなんだ', 'へー', 'うん', 'そっか', 'なるほど'])
    
    def is_universal_chat(self, text: str) -> bool:
        """超汎用会話対象判定"""
        clean_text = text.strip().lower()
        
        # 機能要求・複雑な質問は除外（でも、できるだけ少なく）
        excluded = [
            'リスト出し', 'リスト表示', 'リスト見せ', '一覧出し', '表示して', 
            '教えてください', '説明してください', 'どうやって', '方法教えて',
            'ヘルプ', 'help', '使い方', '手順'
        ]
        
        # 除外パターンに完全一致する場合のみ除外
        if any(ex == clean_text for ex in excluded):
            return False
        
        # 50文字以下なら基本的に対象（人間の普通の会話は短い）
        return len(clean_text) <= 50
    
    def get_pattern_count(self) -> int:
        """総パターン数"""
        return (len(self.universal_patterns) + 
                len(self.contextual_responses) + 
                len(self.emotional_responses) + 
                len(self.situational_responses))